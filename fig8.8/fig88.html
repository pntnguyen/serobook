<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Application of serosv package to Mumps serological data from the UK in 1986 and 1987</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="fig88_files/libs/clipboard/clipboard.min.js"></script>
<script src="fig88_files/libs/quarto-html/quarto.js"></script>
<script src="fig88_files/libs/quarto-html/popper.min.js"></script>
<script src="fig88_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="fig88_files/libs/quarto-html/anchor.min.js"></script>
<link href="fig88_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="fig88_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="fig88_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="fig88_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="fig88_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Application of serosv package to Mumps serological data from the UK in 1986 and 1987</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="use-serosv-package" class="level2">
<h2 class="anchored" data-anchor-id="use-serosv-package">Use “serosv” package</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"OUCRU-Modelling/serosv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(serosv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-dataset" class="level2">
<h2 class="anchored" data-anchor-id="import-dataset">Import dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rubella <span class="ot">&lt;-</span> rubella_uk_1986_1987</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rubella<span class="sc">$</span>neg <span class="ot">&lt;-</span> rubella<span class="sc">$</span>tot <span class="sc">-</span> rubella<span class="sc">$</span>pos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="farringtons-model-with-gamma-0" class="level2">
<h2 class="anchored" data-anchor-id="farringtons-model-with-gamma-0">Farrington’s model with <span class="math inline">\(\gamma\)</span> = 0</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">farrington_model</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">start=</span><span class="fu">list</span>(<span class="at">alpha=</span><span class="fl">0.1</span>,<span class="at">beta=</span><span class="fl">0.1</span>,<span class="at">gamma=</span><span class="fl">0.1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>   ))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$info

Call:
mle(minuslogl = farrington, start = start, fixed = fixed)

Coefficients:
     alpha       beta      gamma 
0.07035482 0.20235373 0.03658457 

$sp
 [1] 0.06980718 0.16284289 0.26576492 0.36501154 0.45397581 0.53046603
 [7] 0.59468313 0.64791416 0.69179469 0.72793959 0.75778572 0.78254511
[13] 0.80321035 0.82058103 0.83529564 0.84786198 0.85868359 0.86808153
[19] 0.87631178 0.88357913 0.89004794 0.89585062 0.90109426 0.90586578
[25] 0.91023596 0.91426270 0.91799348 0.92146742 0.92471683 0.92776851
[31] 0.93064480 0.93336436 0.93594287 0.93839358 0.94072771 0.94295485
[37] 0.94508323 0.94711996 0.94907123 0.95094244 0.95273838 0.95446329
[43] 0.95612098 0.95771487

$foi
 [1] 0.08748223 0.12058008 0.13984314 0.14922954 0.15171152 0.14950376
 [7] 0.14424122 0.13711725 0.12899045 0.12046732 0.11196583 0.10376407
[13] 0.09603753 0.08888736 0.08236168 0.07647165 0.07120337 0.06652672
[19] 0.06240172 0.05878322 0.05562406 0.05287740 0.05049811 0.04844378
[25] 0.04667519 0.04515660 0.04385575 0.04274385 0.04179531 0.04098760
[31] 0.04030095 0.03971811 0.03922410 0.03880593 0.03845238 0.03815383
[37] 0.03790197 0.03768973 0.03751104 0.03736073 0.03723440 0.03712830
[43] 0.03703927 0.03696462

$df
$df$age
 [1]  1.5  2.5  3.5  4.5  5.5  6.5  7.5  8.5  9.5 10.5 11.5 12.5 13.5 14.5 15.5
[16] 16.5 17.5 18.5 19.5 20.5 21.5 22.5 23.5 24.5 25.5 26.5 27.5 28.5 29.5 30.5
[31] 31.5 32.5 33.5 34.5 35.5 36.5 37.5 38.5 39.5 40.5 41.5 42.5 43.5 44.5

$df$pos
 [1]  31  30  34  57  95 104  90  96 134 110 111 147 138 141  53  49  73  69  97
[20]  65  74  84  82  79  90  84  81  72  71  51  45  45  35  39  36  37  37  37
[39]  28  26  25  21  18  18

$df$tot
 [1] 206 146 168 189 219 195 164 145 180 160 148 178 177 165  67  58  81  79 111
[20]  76  82 101  88  85  94  91  89  76  79  56  52  48  37  41  40  38  39  41
[39]  30  27  25  22  19  18


attr(,"class")
[1] "farrington_model"</code></pre>
</div>
</div>
</section>
<section id="find-the-best-fractional-polynomial" class="level2">
<h2 class="anchored" data-anchor-id="find-the-best-fractional-polynomial">Find the best fractional polynomial</h2>
<p><strong>First degree factional polynomial with logit link function</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>best_1d <span class="ot">&lt;-</span> <span class="fu">find_best_fp_powers</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.01</span>), <span class="at">mc=</span>F, <span class="at">degree=</span><span class="dv">1</span>, <span class="at">link=</span><span class="st">"logit"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>best_1d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p
[1] 0.05

$deviance
[1] 56.18916

$model

Call:  glm(formula = as.formula(formulate(p_cur)), family = binomial(link = link))

Coefficients:
              (Intercept)  I(age^0.0499999999999998)  
                   -32.48                      29.67  

Degrees of Freedom: 43 Total (i.e. Null);  42 Residual
Null Deviance:      1369 
Residual Deviance: 56.19    AIC: 226.7</code></pre>
</div>
</div>
<p><strong>Second degree factional polynomial without monotonicity constraint with logit link function</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>best_2d <span class="ot">&lt;-</span> <span class="fu">find_best_fp_powers</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.1</span>), <span class="at">mc=</span><span class="cn">FALSE</span>, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">link=</span><span class="st">"logit"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>best_2d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p
[1] -0.9 -0.9

$deviance
[1] 37.57966

$model

Call:  glm(formula = as.formula(formulate(p_cur)), family = binomial(link = link))

Coefficients:
              (Intercept)                I(age^-0.9)  
                    4.342                     -4.696  
I(I(age^-0.9) * log(age))  
                   -9.845  

Degrees of Freedom: 43 Total (i.e. Null);  41 Residual
Null Deviance:      1369 
Residual Deviance: 37.58    AIC: 210.1</code></pre>
</div>
</div>
<p><strong>Second degree factional polynomial with monotonicity constraint with logit link function</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>best_2d_mn <span class="ot">&lt;-</span> <span class="fu">find_best_fp_powers</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.1</span>), <span class="at">mc =</span> T,<span class="at">degree=</span><span class="dv">2</span>, <span class="at">link=</span><span class="st">"logit"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>best_2d_mn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p
[1] -0.9 -0.9

$deviance
[1] 37.57966

$model

Call:  glm(formula = as.formula(formulate(p_cur)), family = binomial(link = link))

Coefficients:
              (Intercept)                I(age^-0.9)  
                    4.342                     -4.696  
I(I(age^-0.9) * log(age))  
                   -9.845  

Degrees of Freedom: 43 Total (i.e. Null);  41 Residual
Null Deviance:      1369 
Residual Deviance: 37.58    AIC: 210.1</code></pre>
</div>
</div>
<table class="table">
<caption><strong>Deviance and gain values for first and second degree fractional polynomials with logit link function</strong></caption>
<thead>
<tr class="header">
<th>Fractional polynomials</th>
<th style="text-align: center;">Deviance</th>
<th style="text-align: center;">Power</th>
<th style="text-align: center;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>First degree</td>
<td style="text-align: center;">56.19</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">226.7</td>
</tr>
<tr class="even">
<td>Second degree without monocity</td>
<td style="text-align: center;">37.58</td>
<td style="text-align: center;">(-0.9,-0.9)</td>
<td style="text-align: center;">210.1</td>
</tr>
<tr class="odd">
<td>Second degree with monocity</td>
<td style="text-align: center;">37.58</td>
<td style="text-align: center;">(-0.9,-0.9)</td>
<td style="text-align: center;">210.1</td>
</tr>
</tbody>
</table>
<p>Because the deviance and AIC of second degree fractional polynomials are lower than the first degree, the best second degree fractional polynomial for the UK data on rubella was obtained for the powers (−0.9, −0.9)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fpmd <span class="ot">&lt;-</span> <span class="fu">fp_model</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>), <span class="at">link=</span><span class="st">"logit"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>fpmd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$info

Call:  glm(formula = as.formula(formulate(p)), family = binomial(link = link))

Coefficients:
             (Intercept)                I(age^0.9)  I(I(age^0.9) * log(age))  
                 -3.2717                    1.0156                   -0.2174  

Degrees of Freedom: 43 Total (i.e. Null);  41 Residual
Null Deviance:      1369 
Residual Deviance: 46.68    AIC: 219.2

$sp
        1         2         3         4         5         6         7         8 
0.1261071 0.1963209 0.2735484 0.3530314 0.4303609 0.5022901 0.5669385 0.6236014 
        9        10        11        12        13        14        15        16 
0.6724014 0.7139464 0.7490680 0.7786514 0.8035397 0.8244873 0.8421457 0.8570642 
       17        18        19        20        21        22        23        24 
0.8696999 0.8804301 0.8895642 0.8973559 0.9040131 0.9097060 0.9145742 0.9187327 
       25        26        27        28        29        30        31        32 
0.9222761 0.9252822 0.9278154 0.9299288 0.9316663 0.9330638 0.9341509 0.9349515 
       33        34        35        36        37        38        39        40 
0.9354849 0.9357663 0.9358074 0.9356166 0.9351998 0.9345602 0.9336985 0.9326136 
       41        42        43        44 
0.9313020 0.9297584 0.9279756 0.9259444 

$foi
           2            3            4            5            6            7 
 0.091728976  0.107860209  0.121190137  0.131011687  0.137206043  0.140062397 
           8            9           10           11           12           13 
 0.140094748  0.137889820  0.134007308  0.128929400  0.123045099  0.116654292 
          14           15           16           17           18           19 
 0.109980590  0.103186378  0.096386872  0.089661917  0.083065342  0.076632110 
          20           21           22           23           24           25 
 0.070383663  0.064331852  0.058481815  0.052834046  0.047385894  0.042132635 
          26           27           28           29           30           31 
 0.037068239  0.032185912  0.027478483  0.022938668  0.018559263  0.014333264 
          32           33           34           35           36           37 
 0.010253958  0.006314974  0.002510316 -0.001165613 -0.004718008 -0.008151658 
          38           39           40           41           42           43 
-0.011470944 -0.014679850 -0.017781962 -0.020780478 -0.023678209 -0.026477586 

$df
$df$age
 [1]  1.5  2.5  3.5  4.5  5.5  6.5  7.5  8.5  9.5 10.5 11.5 12.5 13.5 14.5 15.5
[16] 16.5 17.5 18.5 19.5 20.5 21.5 22.5 23.5 24.5 25.5 26.5 27.5 28.5 29.5 30.5
[31] 31.5 32.5 33.5 34.5 35.5 36.5 37.5 38.5 39.5 40.5 41.5 42.5 43.5 44.5

$df$pos
 [1]  31  30  34  57  95 104  90  96 134 110 111 147 138 141  53  49  73  69  97
[20]  65  74  84  82  79  90  84  81  72  71  51  45  45  35  39  36  37  37  37
[39]  28  26  25  21  18  18

$df$tot
 [1] 206 146 168 189 219 195 164 145 180 160 148 178 177 165  67  58  81  79 111
[20]  76  82 101  88  85  94  91  89  76  79  56  52  48  37  41  40  38  39  41
[39]  30  27  25  22  19  18


attr(,"class")
[1] "fp_model"</code></pre>
</div>
</div>
</section>
<section id="find-the-best-local-polynomial-fit" class="level2">
<h2 class="anchored" data-anchor-id="find-the-best-local-polynomial-fit">Find the best local polynomial fit</h2>
<p><strong>Plot to find the best % nearest neighbors( alpha) and bandwidth</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gcv</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">nn_seq =</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">h_seq =</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="at">by=</span><span class="dv">1</span>) </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="fig88_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The best local polynomial fit was obtained when using 0.8% of its nearest neighbors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lpmd <span class="ot">&lt;-</span> <span class="fu">lp_model</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   rubella<span class="sc">$</span>age, rubella<span class="sc">$</span>pos, rubella<span class="sc">$</span>tot,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">nn=</span><span class="fl">0.8</span>, <span class="at">kern=</span><span class="st">"tcub"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>lpmd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pi
Call:
locfit(formula = y ~ estimator, family = "binomial", kern = kern)

Number of observations:          44 
Family:  Logistic 
Fitted Degrees of freedom:       4.223 
Residual scale:                  1 

$eta
Call:
locfit(formula = y ~ estimator, family = "binomial", kern = kern, 
    deriv = 1)

Number of observations:          44 
Family:  Logistic 
Fitted Degrees of freedom:       0 
Residual scale:                  1 

$sp
 [1] 0.1558173 0.2083580 0.2693516 0.3365677 0.4069129 0.4770133 0.5438397
 [8] 0.6051501 0.6596460 0.7068836 0.7470528 0.7806701 0.8073821 0.8281995
[15] 0.8444914 0.8573426 0.8676064 0.8759579 0.8829399 0.8889975 0.8945020
[22] 0.8997665 0.9048923 0.9091590 0.9126548 0.9155931 0.9181582 0.9205132
[29] 0.9228044 0.9251631 0.9277056 0.9305310 0.9337179 0.9372053 0.9407210
[36] 0.9442331 0.9477226 0.9511708 0.9545599 0.9578732 0.9610950 0.9642112
[43] 0.9672091 0.9700778

$foi
 [1] 0.05669621 0.07230504 0.08886300 0.10522157 0.12014793 0.13256938
 [7] 0.14176308 0.14743049 0.14965792 0.14880878 0.14540133 0.13998858
[13] 0.13277424 0.12426241 0.11500600 0.10543806 0.09589976 0.08666398
[19] 0.07795342 0.06995427 0.06282639 0.05671110 0.05176656 0.04819539
[25] 0.04589556 0.04471030 0.04447267 0.04500927 0.04614272 0.04769309
[31] 0.04947855 0.05131530 0.05301686 0.05475513 0.05725514 0.06042642
[37] 0.06413668 0.06825131 0.07263335 0.07714355 0.08164045 0.08598057
[43] 0.09001859 0.09360763

$df
$df$age
 [1]  1.5  2.5  3.5  4.5  5.5  6.5  7.5  8.5  9.5 10.5 11.5 12.5 13.5 14.5 15.5
[16] 16.5 17.5 18.5 19.5 20.5 21.5 22.5 23.5 24.5 25.5 26.5 27.5 28.5 29.5 30.5
[31] 31.5 32.5 33.5 34.5 35.5 36.5 37.5 38.5 39.5 40.5 41.5 42.5 43.5 44.5

$df$pos
 [1]  31  30  34  57  95 104  90  96 134 110 111 147 138 141  53  49  73  69  97
[20]  65  74  84  82  79  90  84  81  72  71  51  45  45  35  39  36  37  37  37
[39]  28  26  25  21  18  18

$df$tot
 [1] 206 146 168 189 219 195 164 145 180 160 148 178 177 165  67  58  81  79 111
[20]  76  82 101  88  85  94  91  89  76  79  56  52  48  37  41  40  38  39  41
[39]  30  27  25  22  19  18


attr(,"class")
[1] "lp_model"</code></pre>
</div>
</div>
</section>
<section id="the-best-spline-penalize-likelihood-framework" class="level2">
<h2 class="anchored" data-anchor-id="the-best-spline-penalize-likelihood-framework">The best spline (penalize likelihood framework)</h2>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gam)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> rubella<span class="sc">$</span>pos<span class="sc">/</span>rubella<span class="sc">$</span>tot</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> rubella<span class="sc">$</span>age</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>BICme <span class="ot">&lt;-</span><span class="cf">function</span>(fit){<span class="fu">return</span>(fit<span class="sc">$</span>dev<span class="sc">+</span><span class="fu">log</span>((<span class="fu">dim</span>(fit<span class="sc">$</span>summary.predicted)[<span class="dv">1</span>]))<span class="sc">*</span>(fit<span class="sc">$</span>eff.df))}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>me.fit.BIC.logit<span class="ot">&lt;-</span><span class="fu">pspline.fit</span>(<span class="at">response=</span>y,<span class="at">x.var=</span>a,<span class="at">ps.intervals=</span><span class="dv">20</span>,<span class="at">degree=</span><span class="dv">3</span>,<span class="at">order=</span><span class="dv">2</span>,<span class="at">link=</span><span class="st">"logit"</span>,<span class="at">family=</span><span class="st">"binomial"</span>,<span class="at">lambda=</span><span class="dv">80</span>,<span class="at">x.predicted=</span>a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.0000 2.1365
[1] 2.0000000 0.4213055
[1] 3.0000000 0.1363522
[1] 4.00000000 0.01624748
[1] 5.0000000000 0.0002403525
[1] 6.000000e+00 5.330056e-08</code></pre>
</div>
<div class="cell-output-display">
<p><img src="fig88_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BICme</span>(me.fit.BIC.logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.219835</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,y,<span class="at">cex=</span><span class="fl">0.015</span><span class="sc">*</span>rubella<span class="sc">$</span>tot,<span class="at">pch=</span><span class="dv">1</span>,<span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"seroprevalence"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">45</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(a,me.fit.BIC.logit<span class="sc">$</span>summary.predicted[,<span class="dv">2</span>],<span class="at">lty=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>h1<span class="ot">&lt;-</span><span class="fu">foi.num</span>(a,me.fit.BIC.logit<span class="sc">$</span>summary.predicted[,<span class="dv">2</span>])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(h1<span class="sc">$</span>grid,h1<span class="sc">$</span>foi,<span class="at">lty=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="fig88_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fpmd) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="fig88_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="fig88_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lpmd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="fig88_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>