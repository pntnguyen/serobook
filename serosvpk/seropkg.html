<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>serosv package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="seropkg_files/libs/clipboard/clipboard.min.js"></script>
<script src="seropkg_files/libs/quarto-html/quarto.js"></script>
<script src="seropkg_files/libs/quarto-html/popper.min.js"></script>
<script src="seropkg_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="seropkg_files/libs/quarto-html/anchor.min.js"></script>
<link href="seropkg_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="seropkg_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="seropkg_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="seropkg_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="seropkg_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">serosv package</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="install-package-serosv" class="level2">
<h2 class="anchored" data-anchor-id="install-package-serosv">Install package “serosv”</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"OUCRU-Modelling/serosv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(serosv)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-3.1.3-the-basic-model-in-r" class="level2">
<h2 class="anchored" data-anchor-id="section-3.1.3-the-basic-model-in-r">Section 3.1.3 The Basic Model in R</h2>
<p>Let us consider a population of size N = 5,000 with S(0) = 4,999, I(0) = 1, and R(0) = 0. We assume <span class="math inline">\(v^{-1}\)</span> = 1 year, a life expectancy <span class="math inline">\(\mu^{−1}\)</span> of 75 years, <span class="math inline">\(\mu\)</span> = 1/75, and <span class="math inline">\(\beta\)</span> = 0.0005.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Function in the package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S=</span><span class="dv">4999</span>, <span class="at">I=</span><span class="dv">1</span>, <span class="at">R=</span><span class="dv">0</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">mu=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">75</span>,     <span class="co"># 1 divided by life expectancy (75 years old)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">alpha=</span><span class="dv">0</span>,     <span class="co"># no disease-related death</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">beta=</span><span class="fl">0.0005</span>, <span class="co"># transmission rate</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">nu=</span><span class="dv">1</span>,        <span class="co"># 1 year for infected to recover</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="dv">0</span>          <span class="co"># no vaccination at birth</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>sir <span class="ot">&lt;-</span> <span class="fu">sir_basic_model</span>(times, state, parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  time        S        I         R
1  0.0 4999.000 1.000000 0.0000000
2  0.1 4998.732 1.160221 0.1077427
3  0.2 4998.421 1.346094 0.2326044
4  0.3 4998.061 1.561716 0.3773237
5  0.4 4997.643 1.811844 0.5450805
6  0.5 4997.158 2.101986 0.7395605</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Code in the book</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SIR<span class="ot">&lt;-</span><span class="cf">function</span>(t,state,parameters)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    dX <span class="ot">&lt;-</span> N<span class="sc">*</span>mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">-</span>beta<span class="sc">*</span>Y<span class="sc">*</span>X <span class="sc">-</span> mu<span class="sc">*</span>X</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    dY <span class="ot">&lt;-</span> beta<span class="sc">*</span>Y<span class="sc">*</span>X <span class="sc">-</span> (nu<span class="sc">+</span>alpha<span class="sc">+</span>mu)<span class="sc">*</span>Y</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    dZ <span class="ot">&lt;-</span> N<span class="sc">*</span>mu<span class="sc">*</span>p<span class="sc">+</span>nu<span class="sc">*</span>Y <span class="sc">-</span>mu<span class="sc">*</span>Z</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">c</span>(dX, dY, dZ))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">mu=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">75</span>,<span class="at">beta=</span><span class="fl">0.0005</span>,<span class="at">nu=</span><span class="dv">1</span>,<span class="at">N=</span><span class="dv">5000</span>,<span class="at">p=</span><span class="dv">0</span>,<span class="at">alpha=</span><span class="dv">0</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">X=</span><span class="dv">4999</span>,<span class="at">Y=</span><span class="dv">1</span>,<span class="at">Z=</span><span class="dv">0</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>times<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">250</span>,<span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(deSolve)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>res.scen1 <span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">ode</span>(<span class="at">y=</span>state,<span class="at">times=</span>times,<span class="at">func=</span>SIR,<span class="at">parms=</span>parameters))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  time        X        Y         Z
1  0.0 4999.000 1.000000 0.0000000
2  0.1 4998.732 1.160221 0.1077427
3  0.2 4998.421 1.346094 0.2326044
4  0.3 4998.061 1.561716 0.3773237
5  0.4 4997.643 1.811844 0.5450805
6  0.5 4997.158 2.101986 0.7395605</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="section-3.1.5-the-basic-sir-model-with-vaccination-in-r" class="level2">
<h2 class="anchored" data-anchor-id="section-3.1.5-the-basic-sir-model-with-vaccination-in-r">Section 3.1.5 The Basic SIR Model with Vaccination in R</h2>
<p>For a population of size 5,000, <span class="math inline">\(\beta\)</span> = 0.0005, ν = 1 <span class="math inline">\(year^{−1}\)</span> , life expectancy of 75 years, and vaccination coverage of 20% of newborns</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S=</span><span class="dv">4999</span>, <span class="at">I=</span><span class="dv">1</span>, <span class="at">R=</span><span class="dv">0</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">mu=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">75</span>,     <span class="co"># 1 divided by life expectancy (75 years old)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">alpha=</span><span class="dv">0</span>,     <span class="co"># no disease-related death</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">beta=</span><span class="fl">0.0005</span>, <span class="co"># transmission rate</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">nu=</span><span class="dv">1</span>,        <span class="co"># 1 year for infected to recover</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fl">0.2</span>        <span class="co"># 20% population vaccination at birth</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">800</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>sir_vaccine <span class="ot">&lt;-</span> <span class="fu">sir_basic_model</span>(times, state, parameters)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sir_vaccine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time        S        I         R
1 0.00 4999.000 1.000000 0.0000000
2 0.01 4998.842 1.014973 0.1433986
3 0.02 4998.683 1.030168 0.2869290
4 0.03 4998.524 1.045591 0.4305933
5 0.04 4998.364 1.061243 0.5743935
6 0.05 4998.205 1.077129 0.7183323</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>SIR<span class="ot">&lt;-</span><span class="cf">function</span>(t,state,parameters)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    dX <span class="ot">&lt;-</span> N<span class="sc">*</span>mu<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">-</span>beta<span class="sc">*</span>Y<span class="sc">*</span>X <span class="sc">-</span> mu<span class="sc">*</span>X</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    dY <span class="ot">&lt;-</span> beta<span class="sc">*</span>Y<span class="sc">*</span>X <span class="sc">-</span> v<span class="sc">*</span>Y <span class="sc">-</span> mu<span class="sc">*</span>Y</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    dZ <span class="ot">&lt;-</span> v<span class="sc">*</span>Y <span class="sc">-</span>mu<span class="sc">*</span>Z<span class="sc">+</span>N<span class="sc">*</span>mu<span class="sc">*</span>p</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">c</span>(dX, dY, dZ))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    }) </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">mu=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">75</span>,<span class="at">beta=</span><span class="fl">0.0005</span>,<span class="at">v=</span><span class="dv">1</span>,<span class="at">p=</span><span class="fl">0.2</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">X=</span><span class="dv">4999</span>,<span class="at">Y=</span><span class="dv">1</span>,<span class="at">Z=</span><span class="dv">0</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>times<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">800</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>N<span class="ot">&lt;-</span><span class="dv">5000</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>outp02 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ode</span>(<span class="at">y=</span>state,<span class="at">times=</span>times,<span class="at">func=</span>SIR,<span class="at">parms=</span>parameters))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(outp02)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time        X        Y         Z
1 0.00 4999.000 1.000000 0.0000000
2 0.01 4998.842 1.014973 0.1433986
3 0.02 4998.683 1.030168 0.2869290
4 0.03 4998.524 1.045591 0.4305933
5 0.04 4998.364 1.061243 0.5743935
6 0.05 4998.205 1.077129 0.7183323</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="section-3.2.2-the-sir-model-with-constant-force-of-infection-at-endemic-state-in-r" class="level2">
<h2 class="anchored" data-anchor-id="section-3.2.2-the-sir-model-with-constant-force-of-infection-at-endemic-state-in-r">Section 3.2.2 The SIR Model with Constant Force of Infection at Endemic State in R</h2>
<p>We assume that the duration in the infected class is 10 days, which means that ν = 1/10 <span class="math inline">\(days^{−1}\)</span> or 1/(10/365) = 36.5 <span class="math inline">\(years^{−1}\)</span> .</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">s=</span><span class="fl">0.99</span>,<span class="at">i=</span><span class="fl">0.01</span>,<span class="at">r=</span><span class="dv">0</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a> parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">lambda =</span> <span class="fl">0.05</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">nu=</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">14</span><span class="sc">/</span><span class="dv">365</span>)  <span class="co"># 2 weeks to recover</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>ages<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>static <span class="ot">&lt;-</span> <span class="fu">sir_static_model</span>(ages, state, parameters)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(static)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time         s           i           r
1 0.00 0.9900000 0.010000000 0.000000000
2 0.01 0.9895051 0.008139822 0.002355054
3 0.02 0.9890105 0.006708036 0.004281469
4 0.03 0.9885161 0.005603950 0.005879937
5 0.04 0.9880220 0.004752794 0.007225227
6 0.05 0.9875281 0.004096558 0.008375351</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>SIR<span class="ot">&lt;-</span><span class="cf">function</span>(t,state,parameters)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    ds <span class="ot">&lt;-</span> <span class="sc">-</span>lambda<span class="sc">*</span>s </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    di <span class="ot">&lt;-</span> lambda<span class="sc">*</span>s <span class="sc">-</span> nu<span class="sc">*</span>i</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    dr <span class="ot">&lt;-</span> nu<span class="sc">*</span>r</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">c</span>(ds, di, dr))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    }) </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">## define parameters</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">lambda =</span> <span class="fl">0.05</span>, <span class="at">nu=</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">14</span><span class="sc">/</span><span class="dv">365</span>))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">s=</span><span class="fl">0.99</span>,<span class="at">i=</span><span class="fl">0.01</span>,<span class="at">r=</span><span class="dv">0</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>times<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">90</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(deSolve)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ode</span>(<span class="at">y=</span>state,<span class="at">times=</span>times,<span class="at">func=</span>SIR,<span class="at">parms=</span>parameters))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time         s           i r
1 0.00 0.9900000 0.010000000 0
2 0.01 0.9895051 0.008139812 0
3 0.02 0.9890105 0.006708034 0
4 0.03 0.9885161 0.005603956 0
5 0.04 0.9880220 0.004752798 0
6 0.05 0.9875281 0.004096561 0</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="section-3.4-models-with-maternal-antibodies-and-latent-periods" class="level2">
<h2 class="anchored" data-anchor-id="section-3.4-models-with-maternal-antibodies-and-latent-periods">Section 3.4 Models with Maternal Antibodies and Latent Periods</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mseir <span class="ot">&lt;-</span> <span class="fu">mseir_model</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">a=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="dv">40</span>,<span class="at">length=</span><span class="dv">500</span>), <span class="co"># age range from 0 -&gt; 20 yo</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">gamma=</span><span class="dv">1</span><span class="sc">/</span><span class="fl">0.5</span>, <span class="co"># 6 months in the maternal antibodies</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">lambda=</span><span class="fl">0.2</span>,  <span class="co"># 5 years in the susceptible class</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">sigma=</span><span class="fl">26.07</span>, <span class="co"># 14 days in the latent class</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">nu=</span><span class="fl">36.5</span>      <span class="co"># 10 days in the infected class</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mseir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         a          m         s           e           i         r
1 0.000000 1.00000000 0.0000000 0.000000000 0.000000000 0.0000000
2 1.000000 0.13533528 0.7593283 0.005783403 0.004106717 0.0954463
3 1.078156 0.11575115 0.7669792 0.005855132 0.004165007 0.1072495
4 1.156313 0.09900101 0.7717001 0.005902389 0.004204740 0.1191917
5 1.234469 0.08467475 0.7739432 0.005928933 0.004228760 0.1312243
6 1.312625 0.07242161 0.7740950 0.005937978 0.004239494 0.1433059</code></pre>
</div>
</div>
<p><strong>Function này em viết để plot do bên sách viết thẳng ra plot luôn,nên nếu a thấy cần a push lên package nha a</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plot_mseir <span class="ot">&lt;-</span> <span class="cf">function</span>(model){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> model<span class="sc">$</span>a</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> model<span class="sc">$</span>m</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> model<span class="sc">$</span>s</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  e <span class="ot">&lt;-</span> model<span class="sc">$</span>e</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> model<span class="sc">$</span>i</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> model<span class="sc">$</span>r</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,m,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"M(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(a)))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"a:Proportion of host with maternal antibodies"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,s,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"S(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(a)))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"b:Proportion of susceptibles"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,e,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"E(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(a)))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"c:Proportion of host in the latent class"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,i,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"I(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(a)))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"d:Proportion of infected"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,r,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"R(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(a)))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"e:Proportion host in the immune class"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,(m<span class="sc">+</span>r<span class="sc">+</span>i),<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"seroprevalence"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(a)))</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"f:Proportion of sero-positive"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_mseir</span>(mseir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-12-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-12-6.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>epi11<span class="ot">&lt;-</span> <span class="cf">function</span>(last.age,d,lambda,sigma,ni)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">#d          &lt;- (1/0.5)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">#lambda     &lt;- (1/5) </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">#sigma      &lt;- (34.76)</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ni         &lt;- (31.74)</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        N0         <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        a          <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span>last.age,<span class="at">length=</span><span class="dv">500</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        la         <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        N1a <span class="ot">&lt;-</span> N0<span class="sc">*</span>la</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        ia  <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>d<span class="sc">*</span>a)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        kk1 <span class="ot">&lt;-</span> (d<span class="sc">/</span>(d<span class="sc">-</span>lambda))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        kk2 <span class="ot">&lt;-</span> (<span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>d<span class="sc">*</span>a))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        xa  <span class="ot">&lt;-</span> (d<span class="sc">/</span>(d<span class="sc">-</span>lambda))<span class="sc">*</span>(<span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>d<span class="sc">*</span>a))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">#browser()</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        ha  <span class="ot">&lt;-</span> (</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>               (lambda<span class="sc">*</span>d)<span class="sc">/</span>(d<span class="sc">-</span>lambda)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>               )<span class="sc">*</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>               (</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>               ((<span class="fu">exp</span>(<span class="sc">-</span>sigma<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>a))<span class="sc">/</span>(lambda<span class="sc">-</span>sigma))</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>              <span class="sc">-</span>((<span class="fu">exp</span>(<span class="sc">-</span>sigma<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>d<span class="sc">*</span>a))<span class="sc">/</span>(d<span class="sc">-</span>sigma))</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        ya  <span class="ot">&lt;-</span> (sigma<span class="sc">*</span>lambda<span class="sc">*</span>d)<span class="sc">*</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>               (</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>               ((<span class="fu">exp</span>(<span class="sc">-</span>ni<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>sigma<span class="sc">*</span>a))<span class="sc">/</span>((lambda<span class="sc">-</span>sigma)<span class="sc">*</span>(d<span class="sc">-</span>sigma)<span class="sc">*</span>(sigma<span class="sc">-</span>ni)))</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>              <span class="sc">+</span>((<span class="fu">exp</span>(<span class="sc">-</span>ni<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span>a))<span class="sc">/</span>((lambda<span class="sc">-</span>d)<span class="sc">*</span>(lambda<span class="sc">-</span>sigma)<span class="sc">*</span>(lambda<span class="sc">-</span>ni)))</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>              <span class="sc">+</span>((<span class="fu">exp</span>(<span class="sc">-</span>ni<span class="sc">*</span>a)<span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>d<span class="sc">*</span>a))<span class="sc">/</span>((d<span class="sc">-</span>lambda)<span class="sc">*</span>(d<span class="sc">-</span>sigma)<span class="sc">*</span>(d<span class="sc">-</span>ni)))</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>               )  </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        a  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,a)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        ia <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,ia)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        xa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,xa)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        ha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,ha)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        ya <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,ya)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>        za  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ia <span class="sc">-</span> xa <span class="sc">-</span> ha <span class="sc">-</span>ya   </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,ia,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"M(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,last.age))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"a:Proportion of host with maternal antibodies"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,xa,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"S(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,last.age))</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"b:Proportion of susceptibles"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,ha,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"E(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,last.age))</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"c:Proportion of host in the latent class"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,ya,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"I(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,last.age))</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"d:Proportion of infected"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,za,<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"R(a)"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,last.age))</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"e:Proportion host in the immune class"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a,(ia<span class="sc">+</span>za<span class="sc">+</span>ya),<span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlab=</span><span class="st">"Age"</span>,<span class="at">ylab=</span><span class="st">"seroprevalence"</span>,<span class="at">pch=</span><span class="fl">0.5</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,last.age))</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"f:Proportion of sero-positive"</span>,<span class="at">adj=</span><span class="dv">0</span>,<span class="at">cex=</span><span class="fl">0.35</span>)</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="fu">epi11</span>(<span class="dv">40</span>,<span class="dv">1</span><span class="sc">/</span><span class="fl">0.5</span>,<span class="fl">0.2</span>,<span class="fl">26.07</span>,<span class="fl">36.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-13-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-13-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-13-6.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="an-sir-model-with-interacting-subpopulations" class="level2">
<h2 class="anchored" data-anchor-id="an-sir-model-with-interacting-subpopulations">3.5.1 An SIR Model with Interacting Subpopulations</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">s =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">i =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">r =</span> <span class="fu">c</span>(  <span class="dv">0</span>,   <span class="dv">0</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>beta_matrix <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.00</span>),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">c</span>(<span class="fl">0.00</span>, <span class="fl">0.05</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>   <span class="at">beta =</span> <span class="fu">matrix</span>(beta_matrix, <span class="at">nrow=</span>k, <span class="at">ncol=</span>k, <span class="at">byrow=</span><span class="cn">TRUE</span>),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>   <span class="at">nu =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>   <span class="at">mu =</span> <span class="fl">0.001</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>   <span class="at">k =</span> k</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10000</span>,<span class="at">by=</span><span class="fl">0.5</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>sir_sp <span class="ot">&lt;-</span> <span class="fu">sir_subpops_model</span>(times, state, parameters)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sir_sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time        s1        s2        i1        i2          r1          r2
1  0.0 0.8000000 0.8000000 0.2000000 0.2000000 0.000000000 0.000000000
2  0.5 0.7961052 0.7961052 0.2005577 0.2005577 0.003337146 0.003337146
3  1.0 0.7922208 0.7922208 0.2010974 0.2010974 0.006681767 0.006681767
4  1.5 0.7883475 0.7883475 0.2016190 0.2016190 0.010033558 0.010033558
5  2.0 0.7844854 0.7844854 0.2021224 0.2021224 0.013392251 0.013392251
6  2.5 0.7806350 0.7806350 0.2026075 0.2026075 0.016757489 0.016757489</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Y1=</span><span class="fl">0.8</span>,<span class="at">Y2=</span><span class="fl">0.2</span>,<span class="at">Y3=</span><span class="dv">0</span>,<span class="at">Y4=</span><span class="fl">0.8</span>,<span class="at">Y5=</span><span class="fl">0.2</span>,<span class="at">Y6=</span><span class="dv">0</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>times<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10000</span>,<span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>SIRtwo<span class="ot">&lt;-</span><span class="cf">function</span>(t,state,parameters)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    dY1 <span class="ot">&lt;-</span> <span class="sc">-</span>(beta11<span class="sc">*</span>Y2<span class="sc">+</span>beta12<span class="sc">*</span>Y5)<span class="sc">*</span>Y1<span class="sc">+</span>mu<span class="sc">-</span>mu<span class="sc">*</span>Y1</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    dY2 <span class="ot">&lt;-</span> (beta11<span class="sc">*</span>Y2<span class="sc">+</span>beta12<span class="sc">*</span>Y5)<span class="sc">*</span>Y1<span class="sc">-</span>v1<span class="sc">*</span>Y2<span class="sc">-</span>mu<span class="sc">*</span>Y2</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    dY3 <span class="ot">&lt;-</span> v1<span class="sc">*</span>Y2 <span class="sc">-</span> mu<span class="sc">*</span>Y3</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    dY4 <span class="ot">&lt;-</span> <span class="sc">-</span>(beta21<span class="sc">*</span>Y2<span class="sc">+</span>beta22<span class="sc">*</span>Y5)<span class="sc">*</span>Y4<span class="sc">+</span>mu<span class="sc">-</span>mu<span class="sc">*</span>Y4</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    dY5 <span class="ot">&lt;-</span>  (beta21<span class="sc">*</span>Y2<span class="sc">+</span>beta22<span class="sc">*</span>Y5)<span class="sc">*</span>Y4<span class="sc">-</span>v2<span class="sc">*</span>Y5<span class="sc">-</span>mu<span class="sc">*</span>Y5</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    dY6 <span class="ot">&lt;-</span> v2<span class="sc">*</span>Y5<span class="sc">-</span>mu<span class="sc">*</span>Y6</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">c</span>(dY1,dY2,dY3,dY4,dY5,dY6))</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>}) </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>times<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">10000</span>,<span class="at">by=</span><span class="fl">0.5</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(deSolve)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">beta11=</span><span class="fl">0.05</span>,<span class="at">beta12=</span><span class="fl">0.00</span>,<span class="at">beta21=</span><span class="fl">0.00</span>,<span class="at">beta22=</span><span class="fl">0.05</span>,<span class="at">v1=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>,<span class="at">v2=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">30</span>,<span class="at">mu=</span><span class="fl">0.001</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ode</span>(<span class="at">y=</span>state,<span class="at">times=</span>times,<span class="at">func=</span>SIRtwo,<span class="at">parms=</span>parameters))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time        Y1        Y2          Y3        Y4        Y5          Y6
1  0.0 0.8000000 0.2000000 0.000000000 0.8000000 0.2000000 0.000000000
2  0.5 0.7961052 0.2005577 0.003337146 0.7961052 0.2005577 0.003337146
3  1.0 0.7922208 0.2010974 0.006681767 0.7922208 0.2010974 0.006681767
4  1.5 0.7883475 0.2016190 0.010033558 0.7883475 0.2016190 0.010033558
5  2.0 0.7844854 0.2021224 0.013392251 0.7844854 0.2021224 0.013392251
6  2.5 0.7806350 0.2026075 0.016757489 0.7806350 0.2026075 0.016757489</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="polynomial-models" class="level2">
<h2 class="anchored" data-anchor-id="polynomial-models">6.1.1 Polynomial Models</h2>
<p>Function của em chưa push được lên github</p>
<div class="cell">

</div>
<p>Setup data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> hav_bg_1964</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>neg <span class="ot">&lt;-</span> a<span class="sc">$</span>tot <span class="sc">-</span>a<span class="sc">$</span>pos</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> a<span class="sc">$</span>pos</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> a<span class="sc">$</span>age</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> a<span class="sc">$</span>tot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>muench_model<span class="ot">&lt;-</span> <span class="fu">polynomial_model</span>(age,pos,neg,<span class="at">k =</span><span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>muench_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$info

Call:  glm(formula = age(k), family = binomial(link = "log"), data = df)

Coefficients:
    Age  
-0.0505  

Degrees of Freedom: 83 Total (i.e. Null);  82 Residual
Null Deviance:      Inf 
Residual Deviance: 97.28    AIC: 219.2

$sp
         1          2          3          4          5          6          7 
0.04924645 0.09606768 0.14058313 0.18290636 0.22314532 0.26140265 0.29777594 
         8          9         10         11         12         13         14 
0.33235798 0.36523698 0.39649680 0.42621719 0.45447395 0.48133917 0.50688138 
        15         16         17         18         19         20         21 
0.53116572 0.55425414 0.57620554 0.59707591 0.61691849 0.63578389 0.65372024 
        22         23         24         25         26         27         28 
0.67077329 0.68698653 0.70240133 0.71705701 0.73099095 0.74423869 0.75683402 
        29         30         31         32         33         34         35 
0.76880908 0.78019441 0.79101906 0.80131063 0.81109537 0.82039825 0.82924300 
        36         37         38         39         40         41         42 
0.83765218 0.84564723 0.85324855 0.86047554 0.86734663 0.87387933 0.88009033 
        43         44         45         46         47         48         49 
0.88599545 0.89160977 0.89694761 0.90202257 0.90684761 0.91143503 0.91579654 
        50         51         52         53         54         55         56 
0.91994326 0.92388577 0.92763413 0.93119789 0.93458615 0.93780755 0.94087031 
        57         58         59         60         61         62         63 
0.94378223 0.94655076 0.94918294 0.95168550 0.95406482 0.95632697 0.95847771 
        64         65         66         67         68         69         70 
0.96052253 0.96246666 0.96431504 0.96607240 0.96774321 0.96933174 0.97084205 
        71         72         73         74         75         76         77 
0.97364318 0.97494116 0.97617522 0.97734851 0.97846401 0.97952458 0.98053293 
        78         79         80         81         82         83 
0.98149161 0.98240308 0.98326967 0.98409358 0.98487691 0.98700296 

$foi
            [,1]
 [1,] 0.05050039
 [2,] 0.05050039
 [3,] 0.05050039
 [4,] 0.05050039
 [5,] 0.05050039
 [6,] 0.05050039
 [7,] 0.05050039
 [8,] 0.05050039
 [9,] 0.05050039
[10,] 0.05050039
[11,] 0.05050039
[12,] 0.05050039
[13,] 0.05050039
[14,] 0.05050039
[15,] 0.05050039
[16,] 0.05050039
[17,] 0.05050039
[18,] 0.05050039
[19,] 0.05050039
[20,] 0.05050039
[21,] 0.05050039
[22,] 0.05050039
[23,] 0.05050039
[24,] 0.05050039
[25,] 0.05050039
[26,] 0.05050039
[27,] 0.05050039
[28,] 0.05050039
[29,] 0.05050039
[30,] 0.05050039
[31,] 0.05050039
[32,] 0.05050039
[33,] 0.05050039
[34,] 0.05050039
[35,] 0.05050039
[36,] 0.05050039
[37,] 0.05050039
[38,] 0.05050039
[39,] 0.05050039
[40,] 0.05050039
[41,] 0.05050039
[42,] 0.05050039
[43,] 0.05050039
[44,] 0.05050039
[45,] 0.05050039
[46,] 0.05050039
[47,] 0.05050039
[48,] 0.05050039
[49,] 0.05050039
[50,] 0.05050039
[51,] 0.05050039
[52,] 0.05050039
[53,] 0.05050039
[54,] 0.05050039
[55,] 0.05050039
[56,] 0.05050039
[57,] 0.05050039
[58,] 0.05050039
[59,] 0.05050039
[60,] 0.05050039
[61,] 0.05050039
[62,] 0.05050039
[63,] 0.05050039
[64,] 0.05050039
[65,] 0.05050039
[66,] 0.05050039
[67,] 0.05050039
[68,] 0.05050039
[69,] 0.05050039
[70,] 0.05050039
[71,] 0.05050039
[72,] 0.05050039
[73,] 0.05050039
[74,] 0.05050039
[75,] 0.05050039
[76,] 0.05050039
[77,] 0.05050039
[78,] 0.05050039
[79,] 0.05050039
[80,] 0.05050039
[81,] 0.05050039
[82,] 0.05050039
[83,] 0.05050039

$df
$df$Age
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
[26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
[51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 72 73 74 75 76
[76] 77 78 79 80 81 82 83 86

$df$Pos
 [1]  3  3  3  4  7  4  3  4  7  8  2  3  2  0  5 13  1  3 15 22 15  7  8  7 12
[26]  5 10 15  9  9  9  8  9  8  9 13  6 15 11  6  8 13  7  5  7  9  9 22  6 10
[51]  6 13  8  7 13 11  8  8  9 13  5  5  5  5 10  8  4  5  4  8  9  1  4  7  6
[76]  2  3  2  4  1  1  2  1

$df$Tot
 [1] 16 15 16 13 12 15 12 11 10 15  7  7 11  1 16 41  2  6 32 37 24 10 10 11 15
[26] 10 13 19 12  9 14 10 11  9 14 14  7 16 13  8  8 14 10  5  7  9  9 22  7 10
[51]  6 14  8  7 13 11  8  8 10 16  5  6  5  5 10  8  4  5  5  8  9  1  4  7  6
[76]  2  3  2  4  1  1  2  1


attr(,"class")
[1] "polynomial_model"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muench_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>gf_model <span class="ot">&lt;-</span> <span class="fu">polynomial_model</span>(age,pos,neg,<span class="at">type =</span> <span class="st">"Griffith"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>grf_model <span class="ot">&lt;-</span> <span class="fu">polynomial_model</span>(age,pos,neg,<span class="at">type =</span> <span class="st">"Grenfell"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(grf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-18-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(tot<span class="sc">-</span>pos,pos)<span class="sc">~-</span><span class="dv">1</span><span class="sc">+</span>age,<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"log"</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cbind(tot - pos, pos) ~ -1 + age, family = binomial(link = "log"))

Coefficients:
     Estimate Std. Error z value Pr(&gt;|z|)    
age -0.050500   0.002457  -20.55   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance:    Inf  on 83  degrees of freedom
Residual deviance: 97.275  on 82  degrees of freedom
AIC: 219.19

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">&lt;-</span><span class="fu">glm</span>(<span class="fu">cbind</span>(tot<span class="sc">-</span>pos,pos)<span class="sc">~-</span><span class="dv">1</span><span class="sc">+</span>age<span class="sc">+</span><span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"log"</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cbind(tot - pos, pos) ~ -1 + age + I(age^2), family = binomial(link = "log"))

Coefficients:
           Estimate Std. Error z value Pr(&gt;|z|)    
age      -0.0442616  0.0053697  -8.243   &lt;2e-16 ***
I(age^2) -0.0001889  0.0001491  -1.266    0.205    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance:    Inf  on 83  degrees of freedom
Residual deviance: 95.445  on 81  degrees of freedom
AIC: 219.36

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">&lt;-</span><span class="fu">glm</span>(<span class="fu">cbind</span>(tot<span class="sc">-</span>pos,pos)<span class="sc">~-</span><span class="dv">1</span><span class="sc">+</span>age<span class="sc">+</span><span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(age<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"log"</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cbind(tot - pos, pos) ~ -1 + age + I(age^2) + I(age^3), 
    family = binomial(link = "log"))

Coefficients:
           Estimate Std. Error z value Pr(&gt;|z|)    
age      -5.326e-02  1.032e-02  -5.159 2.49e-07 ***
I(age^2)  5.065e-04  6.508e-04   0.778    0.436    
I(age^3) -1.019e-05  9.149e-06  -1.114    0.265    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance:    Inf  on 83  degrees of freedom
Residual deviance: 93.797  on 80  degrees of freedom
AIC: 219.72

Number of Fisher Scoring iterations: 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las=</span><span class="dv">1</span>,<span class="at">cex.axis=</span><span class="fl">1.1</span>,<span class="at">cex.lab=</span><span class="fl">1.1</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">mgp=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.5</span>, <span class="dv">0</span>),<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">4.1</span>,<span class="fl">4.1</span>,<span class="fl">4.1</span>,<span class="dv">3</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age,pos<span class="sc">/</span>tot,<span class="at">cex=</span><span class="fl">0.1</span><span class="sc">*</span>tot,<span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">86</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">ylab=</span><span class="st">"seroprevalence"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age,<span class="dv">1</span><span class="sc">-</span>model1<span class="sc">$</span>fitted.values,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age,<span class="dv">1</span><span class="sc">-</span>model3<span class="sc">$</span>fitted.values,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age,<span class="dv">1</span><span class="sc">-</span>model4<span class="sc">$</span>fitted.values,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="sc">-</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(age)))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age,<span class="dv">5</span><span class="sc">*</span>X<span class="sc">%*%</span>model1<span class="sc">$</span>coefficients,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="sc">-</span><span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(age)),<span class="dv">2</span><span class="sc">*</span>age)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age,<span class="dv">5</span><span class="sc">*</span>X<span class="sc">%*%</span>model3<span class="sc">$</span>coefficients,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>X<span class="ot">&lt;-</span><span class="sc">-</span><span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(age)),<span class="dv">2</span><span class="sc">*</span>age,<span class="dv">3</span><span class="sc">*</span>age<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(age,<span class="dv">5</span><span class="sc">*</span>X<span class="sc">%*%</span>model4<span class="sc">$</span>coefficients,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="fl">0.0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fl">0.00</span>,<span class="fl">0.04</span>,<span class="fl">0.08</span>))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="st">"force of infection"</span>, <span class="at">las=</span><span class="dv">3</span>,<span class="at">line=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="section-6.1.2-nonlinear-models" class="level2">
<h2 class="anchored" data-anchor-id="section-6.1.2-nonlinear-models">Section 6.1.2 Nonlinear Models</h2>
</section>
<section id="farrington-model" class="level1">
<h1>Farrington model</h1>
<p>setup data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>rb <span class="ot">&lt;-</span> rubella_uk_1986_1987</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> rb<span class="sc">$</span>pos</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> rb<span class="sc">$</span>tot</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> rb<span class="sc">$</span>age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>farrington_md <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">farrington_model</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">start=</span><span class="fu">list</span>(<span class="at">alpha=</span><span class="fl">0.07</span>,<span class="at">beta=</span><span class="fl">0.1</span>,<span class="at">gamma=</span><span class="fl">0.03</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>   ))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>farrington_md</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$info

Call:
mle(minuslogl = farrington, start = start, fixed = fixed)

Coefficients:
     alpha       beta      gamma 
0.07034904 0.20243950 0.03665599 

$sp
 [1] 0.06981359 0.16285202 0.26577188 0.36501247 0.45396891 0.53045123
 [7] 0.59466144 0.64788711 0.69176392 0.72790667 0.75775202 0.78251175
[13] 0.80317827 0.82055099 0.83526820 0.84783760 0.85866263 0.86806422
[19] 0.87629830 0.88356960 0.89004242 0.89584913 0.90109678 0.90587225
[25] 0.91024632 0.91427684 0.91801129 0.92148875 0.92474154 0.92779645
[31] 0.93067580 0.93339825 0.93597948 0.93843273 0.94076924 0.94299858
[37] 0.94512899 0.94716758 0.94912054 0.95099329 0.95279062 0.95451678
[43] 0.95617556 0.95777042

$foi
 [1] 0.08748800 0.12058173 0.13983845 0.14921833 0.15169476 0.14948302
 [7] 0.14421828 0.13709384 0.12896815 0.12044747 0.11194949 0.10375207
[13] 0.09603044 0.08888554 0.08236531 0.07648076 0.07121788 0.06654645
[19] 0.06242645 0.05881265 0.05565789 0.05291529 0.05053974 0.04848881
[25] 0.04672331 0.04520750 0.04390916 0.04279949 0.04185294 0.04104700
[31] 0.04036191 0.03978045 0.03928765 0.03887053 0.03851792 0.03822017
[37] 0.03796902 0.03775738 0.03757922 0.03742937 0.03730344 0.03719769
[43] 0.03710895 0.03703455

$df
$df$age
 [1]  1.5  2.5  3.5  4.5  5.5  6.5  7.5  8.5  9.5 10.5 11.5 12.5 13.5 14.5 15.5
[16] 16.5 17.5 18.5 19.5 20.5 21.5 22.5 23.5 24.5 25.5 26.5 27.5 28.5 29.5 30.5
[31] 31.5 32.5 33.5 34.5 35.5 36.5 37.5 38.5 39.5 40.5 41.5 42.5 43.5 44.5

$df$pos
 [1]  31  30  34  57  95 104  90  96 134 110 111 147 138 141  53  49  73  69  97
[20]  65  74  84  82  79  90  84  81  72  71  51  45  45  35  39  36  37  37  37
[39]  28  26  25  21  18  18

$df$tot
 [1] 206 146 168 189 219 195 164 145 180 160 148 178 177 165  67  58  81  79 111
[20]  76  82 101  88  85  94  91  89  76  79  56  52  48  37  41  40  38  39  41
[39]  30  27  25  22  19  18


attr(,"class")
[1] "farrington_model"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(farrington_md)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>farrington<span class="ot">=</span><span class="cf">function</span>(alpha,beta,gamma)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>((alpha<span class="sc">/</span>beta)<span class="sc">*</span>age<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>beta<span class="sc">*</span>age)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="sc">+</span>(<span class="dv">1</span><span class="sc">/</span>beta)<span class="sc">*</span>((alpha<span class="sc">/</span>beta)<span class="sc">-</span>gamma)<span class="sc">*</span>(<span class="fu">exp</span>(<span class="sc">-</span>beta<span class="sc">*</span>age)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">-</span>gamma<span class="sc">*</span>age)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>ll<span class="ot">=</span>pos<span class="sc">*</span><span class="fu">log</span>(p)<span class="sc">+</span>(tot<span class="sc">-</span>pos)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#alternative definition of the log-likelihood</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>ll<span class="ot">=</span><span class="fu">sum</span>(<span class="fu">log</span>(<span class="fu">dbinom</span>(pos,tot,<span class="at">prob=</span>p)))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="sc">-</span><span class="fu">sum</span>(ll))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats4)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>model5<span class="ot">=</span><span class="fu">suppressWarnings</span>(<span class="fu">mle</span>(farrington,<span class="at">start=</span><span class="fu">list</span>(<span class="at">alpha=</span><span class="fl">0.07</span>,<span class="at">beta=</span><span class="fl">0.1</span>,<span class="at">gamma=</span><span class="fl">0.03</span>)))</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum likelihood estimation

Call:
mle(minuslogl = farrington, start = list(alpha = 0.07, beta = 0.1, 
    gamma = 0.03))

Coefficients:
        Estimate  Std. Error
alpha 0.07034904 0.005429317
beta  0.20243950 0.026093340
gamma 0.03665599 0.014751768

-2 log L: 224.6971 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(model5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 230.6971</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="weibull-model" class="level1">
<h1>Weibull model</h1>
<p>setup data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>hcv <span class="ot">&lt;-</span> hcv_be_2006[<span class="fu">order</span>(hcv_be_2006<span class="sc">$</span>dur), ]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>dur <span class="ot">&lt;-</span> hcv<span class="sc">$</span>dur</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>infected <span class="ot">&lt;-</span> hcv<span class="sc">$</span>seropositive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Ở đây có code em fix lại a check rồi push lên github nha a</strong></p>
<div class="cell">

</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>wb_md <span class="ot">&lt;-</span> <span class="fu">weibull_model</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">t=</span> dur ,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">spos=</span> infected</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>wb_md</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$info

Call:  glm(formula = spos ~ log(t), family = binomial(link = "cloglog"))

Coefficients:
(Intercept)       log(t)  
    -0.2760       0.3807  

Degrees of Freedom: 420 Total (i.e. Null);  419 Residual
Null Deviance:      452.1 
Residual Deviance: 419.4    AIC: 423.4

$foi
  [1] 1.20236962 0.60893971 0.50957055 0.50957055 0.50957055 0.44380429
  [7] 0.36032946 0.36032946 0.36032946 0.36032946 0.36032946 0.33173209
 [13] 0.33173209 0.33173209 0.33173209 0.30839732 0.30839732 0.30839732
 [19] 0.30839732 0.28891804 0.28891804 0.28891804 0.28891804 0.28891804
 [25] 0.28891804 0.28891804 0.27235897 0.27235897 0.25807184 0.25807184
 [31] 0.25807184 0.25807184 0.23457565 0.23457565 0.22476454 0.21595867
 [37] 0.21595867 0.21595867 0.21595867 0.20800132 0.20800132 0.20076766
 [43] 0.20076766 0.19415688 0.18808659 0.18808659 0.18808659 0.18808659
 [49] 0.18808659 0.18808659 0.18808659 0.18808659 0.18808659 0.18808659
 [55] 0.18248874 0.18248874 0.18248874 0.18248874 0.18248874 0.17249236
 [61] 0.17249236 0.17249236 0.17249236 0.17249236 0.16800561 0.16800561
 [67] 0.16800561 0.16800561 0.16800561 0.16381173 0.16381173 0.16381173
 [73] 0.15988101 0.15618772 0.15618772 0.15618772 0.15618772 0.15618772
 [79] 0.15270951 0.15270951 0.15270951 0.15270951 0.15270951 0.15270951
 [85] 0.14942681 0.14942681 0.14942681 0.14942681 0.14942681 0.14632245
 [91] 0.14632245 0.14632245 0.14632245 0.14632245 0.14632245 0.14632245
 [97] 0.14632245 0.14632245 0.14632245 0.14632245 0.14632245 0.14338126
[103] 0.14338126 0.14338126 0.14058980 0.13793611 0.13793611 0.13300050
[109] 0.13300050 0.13070040 0.13070040 0.13070040 0.12850149 0.12850149
[115] 0.12850149 0.12850149 0.12850149 0.12639676 0.12639676 0.12639676
[121] 0.12639676 0.12437985 0.12244498 0.12244498 0.12244498 0.12244498
[127] 0.12244498 0.12244498 0.12244498 0.12244498 0.12244498 0.12244498
[133] 0.12244498 0.12244498 0.12244498 0.12058689 0.11880076 0.11880076
[139] 0.11880076 0.11708220 0.11708220 0.11542716 0.11229309 0.11229309
[145] 0.11229309 0.11229309 0.11229309 0.11229309 0.11080749 0.11080749
[151] 0.10937220 0.10798453 0.10664197 0.10664197 0.10664197 0.10664197
[157] 0.10664197 0.10664197 0.10664197 0.10664197 0.10664197 0.10664197
[163] 0.10664197 0.10664197 0.10664197 0.10664197 0.10534220 0.10408306
[169] 0.10408306 0.10408306 0.10286252 0.10167872 0.10167872 0.10052989
[175] 0.09941439 0.09833069 0.09833069 0.09727734 0.09525639 0.09525639
[181] 0.09525639 0.09525639 0.09525639 0.09525639 0.09525639 0.09428632
[187] 0.09334166 0.09242136 0.09152442 0.09152442 0.09064988 0.09064988
[193] 0.08979686 0.08896452 0.08896452 0.08815205 0.08815205 0.08815205
[199] 0.08735870 0.08735870 0.08735870 0.08658376 0.08658376 0.08658376
[205] 0.08658376 0.08658376 0.08658376 0.08658376 0.08658376 0.08658376
[211] 0.08658376 0.08582653 0.08508639 0.08508639 0.08436270 0.08365489
[217] 0.08296240 0.08162129 0.08097169 0.08097169 0.08033543 0.07971208
[223] 0.07971208 0.07971208 0.07971208 0.07971208 0.07971208 0.07971208
[229] 0.07971208 0.07971208 0.07971208 0.07910122 0.07850246 0.07791540
[235] 0.07733968 0.07622089 0.07622089 0.07514346 0.07514346 0.07461948
[241] 0.07410496 0.07410496 0.07410496 0.07410496 0.07410496 0.07410496
[247] 0.07410496 0.07410496 0.07410496 0.07410496 0.07310317 0.07213603
[253] 0.07213603 0.07074620 0.07029828 0.07029828 0.06942427 0.06942427
[259] 0.06942427 0.06942427 0.06942427 0.06942427 0.06942427 0.06942427
[265] 0.06942427 0.06942427 0.06942427 0.06942427 0.06942427 0.06696384
[271] 0.06696384 0.06657559 0.06619318 0.06544528 0.06544528 0.06544528
[277] 0.06544528 0.06544528 0.06544528 0.06544528 0.06544528 0.06544528
[283] 0.06544528 0.06544528 0.06544528 0.06544528 0.06544528 0.06471909
[289] 0.06266102 0.06201222 0.06201222 0.06201222 0.06201222 0.06201222
[295] 0.06201222 0.06201222 0.06201222 0.06201222 0.06201222 0.06201222
[301] 0.06201222 0.06201222 0.06169435 0.06169435 0.06138070 0.06076573
[307] 0.05987279 0.05901337 0.05901337 0.05901337 0.05901337 0.05901337
[313] 0.05901337 0.05901337 0.05901337 0.05901337 0.05901337 0.05901337
[319] 0.05901337 0.05901337 0.05901337 0.05901337 0.05738727 0.05738727
[325] 0.05661708 0.05661708 0.05636631 0.05636631 0.05636631 0.05636631
[331] 0.05636631 0.05636631 0.05636631 0.05636631 0.05636631 0.05636631
[337] 0.05636631 0.05468873 0.05468873 0.05400879 0.05400879 0.05400879
[343] 0.05400879 0.05400879 0.05400879 0.05400879 0.05400879 0.05400879
[349] 0.05400879 0.05400879 0.05292317 0.05189282 0.05189282 0.05189282
[355] 0.05189282 0.05189282 0.05189282 0.05189282 0.05189282 0.05189282
[361] 0.05189282 0.05189282 0.05189282 0.05189282 0.05189282 0.05053487
[367] 0.04998075 0.04998075 0.04998075 0.04998075 0.04998075 0.04998075
[373] 0.04998075 0.04998075 0.04998075 0.04998075 0.04874730 0.04824257
[379] 0.04824257 0.04824257 0.04824257 0.04824257 0.04824257 0.04824257
[385] 0.04824257 0.04824257 0.04824257 0.04824257 0.04824257 0.04665406
[391] 0.04665406 0.04665406 0.04665406 0.04665406 0.04519543 0.04519543
[397] 0.04519543 0.04519543 0.04519543 0.04519543 0.04464458 0.04385032
[403] 0.04385032 0.04385032 0.04385032 0.04385032 0.04385032 0.04385032
[409] 0.04385032 0.04260509 0.04260509 0.04144828 0.04144828 0.04144828
[415] 0.04144828 0.04037016 0.04037016 0.04037016 0.03936241 0.03936241
[421] 0.03936241

$sp
  [1] 0.2707953 0.3811001 0.4145370 0.4145370 0.4145370 0.4416801 0.4844291
  [8] 0.4844291 0.4844291 0.4844291 0.4844291 0.5019387 0.5019387 0.5019387
 [15] 0.5019387 0.5176096 0.5176096 0.5176096 0.5176096 0.5317906 0.5317906
 [22] 0.5317906 0.5317906 0.5317906 0.5317906 0.5317906 0.5447380 0.5447380
 [29] 0.5566461 0.5566461 0.5566461 0.5566461 0.5779173 0.5779173 0.5874970
 [36] 0.5964845 0.5964845 0.5964845 0.5964845 0.6049456 0.6049456 0.6129358
 [43] 0.6129358 0.6205020 0.6276846 0.6276846 0.6276846 0.6276846 0.6276846
 [50] 0.6276846 0.6276846 0.6276846 0.6276846 0.6276846 0.6345183 0.6345183
 [57] 0.6345183 0.6345183 0.6345183 0.6472560 0.6472560 0.6472560 0.6472560
 [64] 0.6472560 0.6532097 0.6532097 0.6532097 0.6532097 0.6532097 0.6589150
 [71] 0.6589150 0.6589150 0.6643902 0.6696517 0.6696517 0.6696517 0.6696517
 [78] 0.6696517 0.6747141 0.6747141 0.6747141 0.6747141 0.6747141 0.6747141
 [85] 0.6795907 0.6795907 0.6795907 0.6795907 0.6795907 0.6842935 0.6842935
 [92] 0.6842935 0.6842935 0.6842935 0.6842935 0.6842935 0.6842935 0.6842935
 [99] 0.6842935 0.6842935 0.6842935 0.6888332 0.6888332 0.6888332 0.6932197
[106] 0.6974621 0.6974621 0.7055466 0.7055466 0.7094032 0.7094032 0.7094032
[113] 0.7131448 0.7131448 0.7131448 0.7131448 0.7131448 0.7167774 0.7167774
[120] 0.7167774 0.7167774 0.7203063 0.7237367 0.7237367 0.7237367 0.7237367
[127] 0.7237367 0.7237367 0.7237367 0.7237367 0.7237367 0.7237367 0.7237367
[134] 0.7237367 0.7237367 0.7270732 0.7303203 0.7303203 0.7303203 0.7334822
[141] 0.7334822 0.7365625 0.7424927 0.7424927 0.7424927 0.7424927 0.7424927
[148] 0.7424927 0.7453492 0.7453492 0.7481371 0.7508594 0.7535186 0.7535186
[155] 0.7535186 0.7535186 0.7535186 0.7535186 0.7535186 0.7535186 0.7535186
[162] 0.7535186 0.7535186 0.7535186 0.7535186 0.7535186 0.7561173 0.7586576
[169] 0.7586576 0.7586576 0.7611419 0.7635722 0.7635722 0.7659505 0.7682786
[176] 0.7705583 0.7705583 0.7727914 0.7771237 0.7771237 0.7771237 0.7771237
[183] 0.7771237 0.7771237 0.7771237 0.7792259 0.7812873 0.7833093 0.7852931
[190] 0.7852931 0.7872399 0.7872399 0.7891508 0.7910269 0.7910269 0.7928694
[197] 0.7928694 0.7928694 0.7946791 0.7946791 0.7946791 0.7964570 0.7964570
[204] 0.7964570 0.7964570 0.7964570 0.7964570 0.7964570 0.7964570 0.7964570
[211] 0.7964570 0.7982041 0.7999212 0.7999212 0.8016091 0.8032688 0.8049009
[218] 0.8080854 0.8096393 0.8096393 0.8111684 0.8126735 0.8126735 0.8126735
[225] 0.8126735 0.8126735 0.8126735 0.8126735 0.8126735 0.8126735 0.8126735
[232] 0.8141551 0.8156138 0.8170502 0.8184649 0.8212311 0.8212311 0.8239166
[239] 0.8239166 0.8252302 0.8265250 0.8265250 0.8265250 0.8265250 0.8265250
[246] 0.8265250 0.8265250 0.8265250 0.8265250 0.8265250 0.8290598 0.8315245
[253] 0.8315245 0.8350966 0.8362555 0.8362555 0.8385274 0.8385274 0.8385274
[260] 0.8385274 0.8385274 0.8385274 0.8385274 0.8385274 0.8385274 0.8385274
[267] 0.8385274 0.8385274 0.8385274 0.8449991 0.8449991 0.8460306 0.8470493
[274] 0.8490495 0.8490495 0.8490495 0.8490495 0.8490495 0.8490495 0.8490495
[281] 0.8490495 0.8490495 0.8490495 0.8490495 0.8490495 0.8490495 0.8490495
[288] 0.8510015 0.8565867 0.8583635 0.8583635 0.8583635 0.8583635 0.8583635
[295] 0.8583635 0.8583635 0.8583635 0.8583635 0.8583635 0.8583635 0.8583635
[302] 0.8583635 0.8592369 0.8592369 0.8601005 0.8617989 0.8642771 0.8666759
[309] 0.8666759 0.8666759 0.8666759 0.8666759 0.8666759 0.8666759 0.8666759
[316] 0.8666759 0.8666759 0.8666759 0.8666759 0.8666759 0.8666759 0.8666759
[323] 0.8712505 0.8712505 0.8734334 0.8734334 0.8741463 0.8741463 0.8741463
[330] 0.8741463 0.8741463 0.8741463 0.8741463 0.8741463 0.8741463 0.8741463
[337] 0.8741463 0.8789434 0.8789434 0.8809011 0.8809011 0.8809011 0.8809011
[344] 0.8809011 0.8809011 0.8809011 0.8809011 0.8809011 0.8809011 0.8809011
[351] 0.8840425 0.8870413 0.8870413 0.8870413 0.8870413 0.8870413 0.8870413
[358] 0.8870413 0.8870413 0.8870413 0.8870413 0.8870413 0.8870413 0.8870413
[365] 0.8870413 0.8910186 0.8926493 0.8926493 0.8926493 0.8926493 0.8926493
[372] 0.8926493 0.8926493 0.8926493 0.8926493 0.8926493 0.8962950 0.8977928
[379] 0.8977928 0.8977928 0.8977928 0.8977928 0.8977928 0.8977928 0.8977928
[386] 0.8977928 0.8977928 0.8977928 0.8977928 0.9025279 0.9025279 0.9025279
[393] 0.9025279 0.9025279 0.9069022 0.9069022 0.9069022 0.9069022 0.9069022
[400] 0.9069022 0.9085599 0.9109554 0.9109554 0.9109554 0.9109554 0.9109554
[407] 0.9109554 0.9109554 0.9109554 0.9147219 0.9147219 0.9182311 0.9182311
[414] 0.9182311 0.9182311 0.9215082 0.9215082 0.9215082 0.9245754 0.9245754
[421] 0.9245754

$df
       t spos
1    0.1    0
2    0.3    0
3    0.4    0
4    0.4    0
5    0.4    0
6    0.5    0
7    0.7    1
8    0.7    1
9    0.7    0
10   0.7    0
11   0.7    0
12   0.8    1
13   0.8    1
14   0.8    0
15   0.8    1
16   0.9    1
17   0.9    1
18   0.9    1
19   0.9    0
20   1.0    1
21   1.0    1
22   1.0    1
23   1.0    1
24   1.0    1
25   1.0    0
26   1.0    0
27   1.1    0
28   1.1    1
29   1.2    1
30   1.2    1
31   1.2    1
32   1.2    0
33   1.4    1
34   1.4    1
35   1.5    1
36   1.6    1
37   1.6    1
38   1.6    0
39   1.6    1
40   1.7    1
41   1.7    0
42   1.8    1
43   1.8    1
44   1.9    0
45   2.0    0
46   2.0    1
47   2.0    0
48   2.0    1
49   2.0    0
50   2.0    1
51   2.0    0
52   2.0    1
53   2.0    0
54   2.0    0
55   2.1    1
56   2.1    0
57   2.1    1
58   2.1    0
59   2.1    0
60   2.3    1
61   2.3    1
62   2.3    0
63   2.3    0
64   2.3    0
65   2.4    1
66   2.4    1
67   2.4    1
68   2.4    0
69   2.4    1
70   2.5    1
71   2.5    1
72   2.5    1
73   2.6    1
74   2.7    1
75   2.7    1
76   2.7    0
77   2.7    0
78   2.7    1
79   2.8    1
80   2.8    1
81   2.8    1
82   2.8    0
83   2.8    1
84   2.8    0
85   2.9    1
86   2.9    1
87   2.9    1
88   2.9    0
89   2.9    1
90   3.0    1
91   3.0    0
92   3.0    0
93   3.0    0
94   3.0    1
95   3.0    1
96   3.0    1
97   3.0    0
98   3.0    0
99   3.0    1
100  3.0    1
101  3.0    1
102  3.1    1
103  3.1    1
104  3.1    0
105  3.2    0
106  3.3    1
107  3.3    1
108  3.5    0
109  3.5    1
110  3.6    1
111  3.6    1
112  3.6    1
113  3.7    1
114  3.7    1
115  3.7    1
116  3.7    0
117  3.7    0
118  3.8    1
119  3.8    1
120  3.8    1
121  3.8    1
122  3.9    1
123  4.0    0
124  4.0    0
125  4.0    0
126  4.0    0
127  4.0    1
128  4.0    1
129  4.0    1
130  4.0    0
131  4.0    1
132  4.0    0
133  4.0    1
134  4.0    1
135  4.0    1
136  4.1    1
137  4.2    1
138  4.2    1
139  4.2    0
140  4.3    1
141  4.3    1
142  4.4    1
143  4.6    1
144  4.6    1
145  4.6    1
146  4.6    1
147  4.6    0
148  4.6    1
149  4.7    1
150  4.7    1
151  4.8    1
152  4.9    1
153  5.0    1
154  5.0    1
155  5.0    0
156  5.0    1
157  5.0    1
158  5.0    1
159  5.0    1
160  5.0    0
161  5.0    1
162  5.0    0
163  5.0    1
164  5.0    0
165  5.0    1
166  5.0    0
167  5.1    1
168  5.2    1
169  5.2    1
170  5.2    1
171  5.3    1
172  5.4    1
173  5.4    0
174  5.5    1
175  5.6    1
176  5.7    1
177  5.7    0
178  5.8    1
179  6.0    1
180  6.0    1
181  6.0    0
182  6.0    1
183  6.0    1
184  6.0    1
185  6.0    1
186  6.1    1
187  6.2    1
188  6.3    1
189  6.4    1
190  6.4    1
191  6.5    1
192  6.5    1
193  6.6    1
194  6.7    1
195  6.7    0
196  6.8    1
197  6.8    1
198  6.8    1
199  6.9    1
200  6.9    0
201  6.9    1
202  7.0    0
203  7.0    1
204  7.0    1
205  7.0    0
206  7.0    0
207  7.0    1
208  7.0    1
209  7.0    1
210  7.0    0
211  7.0    0
212  7.1    1
213  7.2    1
214  7.2    1
215  7.3    0
216  7.4    1
217  7.5    1
218  7.7    1
219  7.8    1
220  7.8    1
221  7.9    1
222  8.0    1
223  8.0    1
224  8.0    1
225  8.0    1
226  8.0    1
227  8.0    1
228  8.0    1
229  8.0    1
230  8.0    1
231  8.0    0
232  8.1    1
233  8.2    1
234  8.3    0
235  8.4    1
236  8.6    1
237  8.6    0
238  8.8    1
239  8.8    1
240  8.9    1
241  9.0    1
242  9.0    1
243  9.0    1
244  9.0    1
245  9.0    0
246  9.0    1
247  9.0    1
248  9.0    1
249  9.0    0
250  9.0    1
251  9.2    1
252  9.4    1
253  9.4    1
254  9.7    1
255  9.8    1
256  9.8    1
257 10.0    1
258 10.0    0
259 10.0    1
260 10.0    1
261 10.0    0
262 10.0    1
263 10.0    1
264 10.0    1
265 10.0    1
266 10.0    1
267 10.0    1
268 10.0    1
269 10.0    1
270 10.6    1
271 10.6    1
272 10.7    1
273 10.8    1
274 11.0    1
275 11.0    1
276 11.0    1
277 11.0    1
278 11.0    1
279 11.0    0
280 11.0    1
281 11.0    1
282 11.0    0
283 11.0    1
284 11.0    0
285 11.0    1
286 11.0    1
287 11.0    1
288 11.2    1
289 11.8    1
290 12.0    1
291 12.0    1
292 12.0    0
293 12.0    1
294 12.0    1
295 12.0    1
296 12.0    1
297 12.0    1
298 12.0    1
299 12.0    1
300 12.0    1
301 12.0    1
302 12.0    1
303 12.1    1
304 12.1    1
305 12.2    1
306 12.4    1
307 12.7    1
308 13.0    0
309 13.0    1
310 13.0    1
311 13.0    1
312 13.0    1
313 13.0    1
314 13.0    1
315 13.0    0
316 13.0    1
317 13.0    1
318 13.0    0
319 13.0    1
320 13.0    0
321 13.0    1
322 13.0    1
323 13.6    1
324 13.6    1
325 13.9    1
326 13.9    1
327 14.0    1
328 14.0    1
329 14.0    1
330 14.0    1
331 14.0    0
332 14.0    1
333 14.0    1
334 14.0    0
335 14.0    1
336 14.0    1
337 14.0    1
338 14.7    1
339 14.7    1
340 15.0    1
341 15.0    1
342 15.0    1
343 15.0    1
344 15.0    0
345 15.0    1
346 15.0    0
347 15.0    1
348 15.0    1
349 15.0    1
350 15.0    1
351 15.5    1
352 16.0    1
353 16.0    1
354 16.0    1
355 16.0    1
356 16.0    1
357 16.0    1
358 16.0    1
359 16.0    0
360 16.0    1
361 16.0    1
362 16.0    1
363 16.0    1
364 16.0    1
365 16.0    1
366 16.7    1
367 17.0    1
368 17.0    1
369 17.0    1
370 17.0    1
371 17.0    1
372 17.0    1
373 17.0    1
374 17.0    0
375 17.0    0
376 17.0    1
377 17.7    1
378 18.0    1
379 18.0    1
380 18.0    1
381 18.0    1
382 18.0    0
383 18.0    1
384 18.0    1
385 18.0    1
386 18.0    1
387 18.0    1
388 18.0    1
389 18.0    1
390 19.0    1
391 19.0    1
392 19.0    1
393 19.0    1
394 19.0    1
395 20.0    1
396 20.0    0
397 20.0    1
398 20.0    1
399 20.0    1
400 20.0    1
401 20.4    1
402 21.0    1
403 21.0    1
404 21.0    0
405 21.0    1
406 21.0    1
407 21.0    1
408 21.0    1
409 21.0    1
410 22.0    1
411 22.0    1
412 23.0    1
413 23.0    1
414 23.0    1
415 23.0    0
416 24.0    1
417 24.0    1
418 24.0    1
419 25.0    1
420 25.0    1
421 25.0    1

attr(,"class")
[1] "weibull_model"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wb_md)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>log.d <span class="ot">&lt;-</span> <span class="fu">log</span>(dur)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>hcvfit<span class="ot">=</span>(<span class="fu">glm</span>(infected<span class="sc">~</span>log.d, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>)))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hcvfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = infected ~ log.d, family = binomial(link = "cloglog"))

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.27596    0.14603  -1.890   0.0588 .  
log.d        0.38074    0.07113   5.353 8.65e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 452.06  on 420  degrees of freedom
Residual deviance: 419.38  on 419  degrees of freedom
AIC: 423.38

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</div>
</div>
<section id="section-6.2-fractional-polynomial-models" class="level2">
<h2 class="anchored" data-anchor-id="section-6.2-fractional-polynomial-models">Section 6.2 Fractional Polynomial Models</h2>
<p>Hepatitis A data from Belgium anno 1993–1994</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>hav <span class="ot">&lt;-</span> hav_be_1993_1994</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> hav<span class="sc">$</span>age</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> hav<span class="sc">$</span>pos</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> hav<span class="sc">$</span>tot</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>neg <span class="ot">&lt;-</span> hav<span class="sc">$</span>neg <span class="ot">&lt;-</span> hav<span class="sc">$</span>tot <span class="sc">-</span> hav<span class="sc">$</span>pos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>best_1d <span class="ot">&lt;-</span> <span class="fu">find_best_fp_powers</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.01</span>), <span class="at">mc=</span><span class="cn">FALSE</span>, <span class="at">degree=</span><span class="dv">1</span>, <span class="at">link=</span><span class="st">"logit"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>best_1d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p
[1] 0.42

$deviance
[1] 114.2489

$model

Call:  glm(formula = as.formula(formulate(p_cur)), family = binomial(link = link))

Coefficients:
(Intercept)  I(age^0.42)  
     -6.519        1.444  

Degrees of Freedom: 85 Total (i.e. Null);  84 Residual
Null Deviance:      1320 
Residual Deviance: 114.2    AIC: 391.8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>best_2d_mono <span class="ot">&lt;-</span> <span class="fu">find_best_fp_powers</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.1</span>), <span class="at">mc=</span> <span class="cn">TRUE</span>, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">link=</span><span class="st">"logit"</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>best_2d_mono</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p
[1] 1.0 1.6

$deviance
[1] 93.44652

$model

Call:  glm(formula = as.formula(formulate(p_cur)), family = binomial(link = link))

Coefficients:
(Intercept)     I(age^1)   I(age^1.6)  
  -4.696133     0.210573    -0.009165  

Degrees of Freedom: 85 Total (i.e. Null);  83 Residual
Null Deviance:      1320 
Residual Deviance: 93.45    AIC: 373</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>best_2d <span class="ot">&lt;-</span> <span class="fu">find_best_fp_powers</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">p=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.1</span>), <span class="at">mc=</span> <span class="cn">FALSE</span>, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">link=</span><span class="st">"logit"</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>best_2d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$p
[1] 1.9 2.0

$deviance
[1] 79.58029

$model

Call:  glm(formula = as.formula(formulate(p_cur)), family = binomial(link = link))

Coefficients:
(Intercept)   I(age^1.9)     I(age^2)  
   -3.27042      0.03275     -0.02038  

Degrees of Freedom: 85 Total (i.e. Null);  83 Residual
Null Deviance:      1320 
Residual Deviance: 79.58    AIC: 359.2</code></pre>
</div>
</div>
<table class="table">
<thead>
<tr class="header">
<th>Fractional polynomials</th>
<th style="text-align: center;">Deviance</th>
<th style="text-align: center;">Power</th>
<th style="text-align: center;">AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>First degree</td>
<td style="text-align: center;">114.25</td>
<td style="text-align: center;">0.42</td>
<td style="text-align: center;">391.8</td>
</tr>
<tr class="even">
<td>Second degree without monocity</td>
<td style="text-align: center;">93.45</td>
<td style="text-align: center;">(1.0,1.6)</td>
<td style="text-align: center;">373</td>
</tr>
<tr class="odd">
<td>Second degree with monocity</td>
<td style="text-align: center;">79.58</td>
<td style="text-align: center;">(1.9,2.0)</td>
<td style="text-align: center;">359.2</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fp_1d<span class="ot">&lt;-</span> <span class="fu">fp_model</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="at">p=</span><span class="fu">c</span>(<span class="fl">0.42</span>), <span class="at">link=</span><span class="st">"logit"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fp_1d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fp_2d<span class="ot">&lt;-</span> <span class="fu">fp_model</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="at">p=</span><span class="fu">c</span>(<span class="fl">1.0</span>, <span class="fl">1.6</span>), <span class="at">link=</span><span class="st">"logit"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fp_2d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fp_2d_mono <span class="ot">&lt;-</span> <span class="fu">fp_model</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="at">p=</span><span class="fu">c</span>(<span class="fl">1.9</span>, <span class="fl">2.0</span>), <span class="at">link=</span><span class="st">"logit"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fp_2d_mono)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search.fracpoly.one</span>(<span class="at">y=</span>hav<span class="sc">$</span>neg,<span class="at">tot=</span>hav<span class="sc">$</span>tot,<span class="at">x=</span>hav<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$power
[1] 0.42

$deviance
[1] 114.2489

$mistake
NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>agep<span class="ot">=</span>hav<span class="sc">$</span>age<span class="sc">^</span>(<span class="fl">0.42</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fitp1<span class="ot">=</span><span class="fu">glm</span>(<span class="fu">cbind</span>(hav<span class="sc">$</span>neg,hav<span class="sc">$</span>tot<span class="sc">-</span>hav<span class="sc">$</span>neg)<span class="sc">~</span>agep,<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>fitlin<span class="ot">=</span><span class="fu">glm</span>(<span class="fu">cbind</span>(hav<span class="sc">$</span>neg,hav<span class="sc">$</span>tot<span class="sc">-</span>hav<span class="sc">$</span>neg)<span class="sc">~</span>hav<span class="sc">$</span>age,<span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>fitlin<span class="sc">$</span>deviance<span class="sc">-</span>fitp1<span class="sc">$</span>deviance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35.31336</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search.fracpoly.two</span>(<span class="at">y=</span>hav<span class="sc">$</span>neg,<span class="at">tot=</span>hav<span class="sc">$</span>tot,<span class="at">x=</span>hav<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$power
[1] 1.9 2.0

$deviance
[1] 79.58029

$mistake
      [,1] [,2] [,3]
 [1,]    1 -1.0 -0.9
 [2,]    1 -1.0 -0.8
 [3,]    1 -1.0 -0.7
 [4,]    1 -0.9 -0.9
 [5,]    1 -0.9 -0.8
 [6,]    1 -0.9 -0.7
 [7,]    1 -0.8 -0.8
 [8,]    1 -0.8 -0.7
 [9,]    1 -0.8 -0.6
[10,]    1 -0.7 -0.7
[11,]    1 -0.7 -0.6
[12,]    1 -0.6 -0.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model.fp1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(pos,tot<span class="sc">-</span>pos) <span class="sc">~</span> age, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>model.fp2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(pos,tot<span class="sc">-</span>pos) <span class="sc">~</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="fl">1.9</span>) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>), <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>model.fp2.m <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(pos,tot<span class="sc">-</span>pos) <span class="sc">~</span> <span class="fu">I</span>(age) <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="fl">1.6</span>), <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>model.fp1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = cbind(pos, tot - pos) ~ age, family = binomial(link = "logit"))

Coefficients:
(Intercept)          age  
   -2.95641      0.07731  

Degrees of Freedom: 85 Total (i.e. Null);  84 Residual
Null Deviance:      1320 
Residual Deviance: 149.6    AIC: 427.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model.fp2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = cbind(pos, tot - pos) ~ I(age^1.9) + I(age^2), 
    family = binomial(link = "logit"))

Coefficients:
(Intercept)   I(age^1.9)     I(age^2)  
   -3.27042      0.03275     -0.02038  

Degrees of Freedom: 85 Total (i.e. Null);  83 Residual
Null Deviance:      1320 
Residual Deviance: 79.58    AIC: 359.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>model.fp2.m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = cbind(pos, tot - pos) ~ I(age) + I(age^1.6), family = binomial(link = "logit"))

Coefficients:
(Intercept)       I(age)   I(age^1.6)  
  -4.696133     0.210573    -0.009165  

Degrees of Freedom: 85 Total (i.e. Null);  83 Residual
Null Deviance:      1320 
Residual Deviance: 93.45    AIC: 373</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search.fracpoly.twoR</span>(<span class="at">y=</span>hav<span class="sc">$</span>neg,<span class="at">tot=</span>hav<span class="sc">$</span>tot,<span class="at">x=</span>hav<span class="sc">$</span>age,<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="fl">0.1</span>),T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scatterplot3d)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las=</span><span class="dv">1</span>,<span class="at">cex.axis=</span><span class="fl">1.1</span>,<span class="at">cex.lab=</span><span class="fl">1.1</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">mgp=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.5</span>, <span class="dv">0</span>),<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">4.1</span>,<span class="fl">4.1</span>,<span class="fl">4.1</span>,<span class="dv">3</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hav<span class="sc">$</span>age,hav<span class="sc">$</span>pos<span class="sc">/</span>hav<span class="sc">$</span>tot,<span class="at">cex=</span><span class="fl">0.03</span><span class="sc">*</span>hav<span class="sc">$</span>tot,<span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"seroprevalence"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">86</span>),<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="dv">1</span>),<span class="at">yaxt=</span><span class="st">"n"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(hav<span class="sc">$</span>age,model.fp1<span class="sc">$</span>fitted.values,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(hav<span class="sc">$</span>age,model.fp2<span class="sc">$</span>fitted.values,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(hav<span class="sc">$</span>age,model.fp2.m<span class="sc">$</span>fitted.values,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>model.fp1.foi<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">foi.num</span>(hav<span class="sc">$</span>age,model.fp1<span class="sc">$</span>fitted.values))</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>model.fp2.foi<span class="ot">&lt;-</span><span class="fu">foi.num</span>(hav<span class="sc">$</span>age,model.fp2<span class="sc">$</span>fitted.values)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>model.fp2.m.foi<span class="ot">&lt;-</span><span class="fu">foi.num</span>(hav<span class="sc">$</span>age,model.fp2.m<span class="sc">$</span>fitted.values)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(model.fp1.foi<span class="sc">$</span>grid,<span class="dv">4</span><span class="sc">*</span>model.fp1.foi<span class="sc">$</span>foi,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(model.fp2.foi<span class="sc">$</span>grid,<span class="dv">4</span><span class="sc">*</span>model.fp2.foi<span class="sc">$</span>foi,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(model.fp2.m.foi<span class="sc">$</span>grid,<span class="dv">4</span><span class="sc">*</span>model.fp2.m.foi<span class="sc">$</span>foi,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="fl">0.0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>,<span class="fl">0.00</span>,<span class="fl">0.05</span>,<span class="fl">0.10</span>))</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>,<span class="at">at=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>),<span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>))</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="fl">0.0</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="fl">0.00</span>,<span class="fl">0.05</span>,<span class="fl">0.10</span>))</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>,<span class="at">at=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>),<span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>))</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="st">"force of infection"</span>, <span class="at">las=</span><span class="dv">3</span>,<span class="at">line=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="local-estimation-by-polynomials" class="level2">
<h2 class="anchored" data-anchor-id="local-estimation-by-polynomials">7.1.2 Local Estimation by Polynomials</h2>
<p>Application to UK Mumps Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>mump <span class="ot">&lt;-</span> mumps_uk_1986_1987</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> age <span class="ot">&lt;-</span> mump<span class="sc">$</span>age</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> mump<span class="sc">$</span>pos</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> mump<span class="sc">$</span>tot</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> pos<span class="sc">/</span>tot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gcv</span>(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>   age, pos, tot,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">nn_seq =</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">h_seq =</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(locfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>locfit 1.5-9.8   2023-06-11</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'locfit'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    none</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>alpha<span class="ot">=</span><span class="fu">seq</span>(<span class="fl">0.2</span>,<span class="fl">0.8</span>, <span class="at">by=</span><span class="fl">0.05</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>res<span class="ot">=</span><span class="fu">cbind</span>(alpha,<span class="fu">summary</span>(<span class="fu">gcvplot</span>(y<span class="sc">~</span>a,<span class="at">family=</span><span class="st">"binomial"</span>,<span class="at">alpha=</span>alpha)))</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res[,<span class="dv">1</span>],res[,<span class="dv">3</span>],<span class="at">type=</span><span class="st">"n"</span>,<span class="at">xlab=</span><span class="st">"% Neighbors"</span>,<span class="at">ylab=</span><span class="st">" "</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(res[,<span class="dv">1</span>],res[,<span class="dv">3</span>])</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side=</span><span class="dv">2</span>,<span class="st">"GCV"</span>,<span class="at">las=</span><span class="dv">3</span>,<span class="at">line=</span><span class="fl">2.4</span>,<span class="at">cex=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>alpha<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(<span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">25</span>, <span class="at">by=</span><span class="dv">1</span>))),<span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">25</span>, <span class="at">by=</span><span class="dv">1</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>res<span class="ot">=</span><span class="fu">cbind</span>(alpha[,<span class="dv">2</span>],<span class="fu">summary</span>(<span class="fu">gcvplot</span>(y<span class="sc">~</span>a,<span class="at">family=</span><span class="st">"binomial"</span>,<span class="at">alpha=</span>alpha)))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res[,<span class="dv">1</span>],res[,<span class="dv">3</span>],<span class="at">type=</span><span class="st">"n"</span>,<span class="at">xlab=</span><span class="st">"Bandwidth"</span>,<span class="at">ylab=</span><span class="st">" "</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(res[,<span class="dv">1</span>],res[,<span class="dv">3</span>])</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side=</span><span class="dv">2</span>,<span class="st">"GCV"</span>,<span class="at">las=</span><span class="dv">3</span>,<span class="at">line=</span><span class="dv">3</span>,<span class="at">cex=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="fit-local-polynomial-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-local-polynomial-model">Fit local polynomial model</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>lp1 <span class="ot">&lt;-</span> <span class="fu">lp_model</span>(age, pos, tot, <span class="at">kern=</span><span class="st">"tcub"</span>, <span class="at">nn=</span><span class="fl">0.7</span>, <span class="at">deg=</span><span class="dv">2</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lp1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(age,y,<span class="at">cex=</span><span class="fl">0.003</span><span class="sc">*</span>tot,<span class="at">pch=</span><span class="dv">19</span>,<span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"seroprevalence"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>,<span class="dv">1</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>lpfit<span class="ot">&lt;-</span><span class="fu">locfit</span>(y<span class="sc">~</span>a,<span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(a,<span class="fu">fitted</span>(lpfit),<span class="at">lty=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>lpfitd1<span class="ot">&lt;-</span><span class="fu">locfit</span>(y<span class="sc">~</span>a,<span class="at">deriv=</span><span class="dv">1</span>,<span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>lpfoi<span class="ot">=</span><span class="fu">fitted</span>(lpfitd1)<span class="sc">*</span><span class="fu">fitted</span>(lpfit)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(a,lpfoi,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="at">at=</span><span class="fu">c</span>(<span class="fl">0.0</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>))</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="at">side=</span><span class="dv">4</span>,<span class="st">"force of infection"</span>, <span class="at">las=</span><span class="dv">3</span>,<span class="at">line=</span><span class="fl">1.6</span>,<span class="at">cex=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seropkg_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>